<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Elytron: Using case principal transformers in Elytron</title>
    <script src="/wildfly-elytron/assets/javascript/highlight.pack.js" type="text/javascript"></script>

    <link rel="shortcut icon" type="image/png" href="/wildfly-elytron/favicon.ico">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- We override the colours from this theme manually -->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="/wildfly-elytron/assets/css/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script src="/wildfly-elytron/assets/javascript/hl.js" type="text/javascript"></script>
    <link rel="alternate" type="application/rss+xml"  href="/wildfly-elytron/feed.xml" title="WildFly Elytron">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135301155-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-135301155-1');
    </script>
</head>
<body>


<!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header mdl-layout__header--scroll">
        <div class="mdl-layout__header-row ">
            <!-- Title -->
            <span class="mdl-layout-title"><h3>Wild<strong>Fly</strong>  Elytron</h3></span>
            <!-- Add spacer, to align navigation to the right -->
            <div class="mdl-layout-spacer"></div>
            <nav class="mdl-navigation mdl-layout--large-screen-only">
                
                    
                    
                         <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
                    
                
                    
                    
                         <a class="mdl-navigation__link Docs-menuitem" href="https://docs.wildfly.org/22/WildFly_Elytron_Security.html">Docs</a>
                    
                
                    
                    
                         <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
                    
                
                    
                    
                         <a class="mdl-navigation__link mdl-navigation__link--current Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
                    
                
                    
                    
                         <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
                    
                
            </nav>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <div class="side-drawer-logo-container"><h3>Wild<strong>Fly</strong>  Elytron</h3></div>
        <nav class="mdl-navigation">
            
            
            
                <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
            
            
            
            
                <a class="mdl-navigation__link Docs-menuitem" href="https://docs.wildfly.org/22/WildFly_Elytron_Security.html">Docs</a>
            
            
            
            
                <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
            
            
            
            
                <a class="mdl-navigation__link mdl-navigation__link--current Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
            
            
            
            
                <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
            
            
            <!-- mdl-navigation__link--current -->
        </nav>
    </div>
    <main class="mdl-layout__content">
        <div class="page-content">
            
            <div class="content">
                <div class="post-page grid-wrapper">
  <div class="grid__item width-12-12 width-12-12-m doc-content">
    <h1>Using case principal transformers in Elytron</h1>
    <div class="grid-wrapper">
      <div class="grid__item width-8-12 width-12-12-m byline-wrapper">
        
        
          <img class="headshot" src="https://www.gravatar.com/avatar/abf96d05af53c494685384d382dba345">
        
        <p class="byline">By <a href="https://github.com/SoniaZaldana">Sonia Zaldana Calles</a> | January 12, 2021</p>
      </div>
      
      <div class="grid__item width-4-12 width-12-12-m"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://wildfly-security.github.io/wildfly-elytron/blog/case-principal-transformer/&title=Using case principal transformers in Elytron" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fab fa-linkedin"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Using case principal transformers in Elytron&url=https://wildfly-security.github.io/wildfly-elytron/blog/case-principal-transformer/&via=WildFlyAS&related=WildFlyAS" rel="nofollow" target="_blank" title="Share on Twitter">
    <i class="fab fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://wildfly-security.github.io/wildfly-elytron/blog/case-principal-transformer/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fab fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://wildfly-security.github.io/wildfly-elytron/blog/case-principal-transformer/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fab fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Using case principal transformers in Elytron&amp;body=Using case principal transformers in Elytron https://wildfly-security.github.io/wildfly-elytron/blog/case-principal-transformer/" title="Share via Email" >
    <i class="fas fa-envelope-square"></i>
  </a>
</div>
</div>
      <div class="grid__item width-12-12">
          <div class="paragraph">
<p>The <strong><a href="https://github.com/wildfly-security-incubator/elytron-examples/tree/master/case-principal-transformer">case-principal-transformer</a></strong>
quickstart demonstrates how to use a <code>case-principal-transformer</code> to adjust a principal to upper case
when securing  EJBs. Note, the quickstart is building from this <strong><a href="https://wildfly-security.github.io/wildfly-elytron/blog/advanced-ejb-security/">post</a></strong> which more closely explains how to configure filesystem realms and SASL authentication to secure EJBs.</p>
</div>
<div class="sect1">
<h2 id="an-overview-of-the-case-principal-transformer"><a class="anchor" href="#an-overview-of-the-case-principal-transformer"></a>An Overview of the Case Principal Transformer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Principal transformers take a name and map it to another representation of the name or perform some
normalisation. The new <code>case-principal-transformer</code> in the Elytron subsystem allows converting a principal to upper or lower case.
Previously, a custom transformer was required to adjust a principal&#8217;s username to
upper/lower case.</p>
</div>
<div class="paragraph">
<p>In particular, this new principal transformer has the following optional attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>upper-case</code> - A boolean value which adjusts the principal to upper case when set to <code>true</code> and
adjusts the principal to lower case when set to <code>false</code>. Note: If omitted, this value is set to <code>true</code> by default.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reviewing-the-elytron-configuration"><a class="anchor" href="#reviewing-the-elytron-configuration"></a>Reviewing the Elytron Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the following section, we will review the configuration available in the script for the quickstart
<strong><a href="https://github.com/wildfly-security-incubator/elytron-examples/blob/master/case-principal-transformer/configure-elytron.cli">configure-elytron.cli</a></strong>. We start our configuration by connecting to the server using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ WILDFLY_HOME/bin/jboss-cli.sh --connect</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="note-use-of-wildfly_home"><a class="anchor" href="#note-use-of-wildfly_home"></a>Note: Use of WILDFLY_HOME</h4>
<div class="paragraph">
<p>In the following post, replace <code>WILDFLY_HOME</code> with the actual path to your WildFly installation.</p>
</div>
<div class="paragraph">
<p>We then create a filesystem realm under the Elytron subsystem, followed by adding an identity in upper case
(<code>QUICKSTARTUSER</code>), and a simple role decoder as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/subsystem=elytron/filesystem-realm=exampleRealm:add(path=fs-realm-users, relative-to=jboss.server.config.dir)

/subsystem=elytron/filesystem-realm=exampleRealm:add-identity(identity=QUICKSTARTUSER)

/subsystem=elytron/filesystem-realm=exampleRealm:set-password(clear={password="quickstartPwd1!"}, identity=QUICKSTARTUSER)

/subsystem=elytron/filesystem-realm=exampleRealm:add-identity-attribute(identity=QUICKSTARTUSER, name=Roles, value=["Admin", "Guest"])

/subsystem=elytron/simple-role-decoder=from-roles-attribute:add(attribute=Roles)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about creating FileSystem realms along with all of its possible configurations,
please refer to the <a href="https://docs.wildfly.org/22/WildFly_Elytron_Security.html">Elytron documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-a-case-principal-transformer"><a class="anchor" href="#configuring-a-case-principal-transformer"></a>Configuring a Case Principal Transformer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Adding a <code>case-principal-transformer</code> that converts a principal to upper/lower case takes the general form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/subsystem=elytron/case-principal-transformer=transformerName:add(upper-case="...")</code></pre>
</div>
</div>
<div class="paragraph">
<p>In our example, the <code>case-principal-transformer</code> is configured to specify that a principal should
be transformed to upper case as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/subsystem=elytron/case-principal-transformer=myTransformer:add(upper-case=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note, the <code>upper-case</code> attribute can be omitted as it will be set to <code>true</code> by default.</p>
</div>
<div class="paragraph">
<p>We then configure a new security domain <code>caseDomain</code> to use our filesystem realm, role decoder
and the case principal transformer as a <code>pre-realm-principal-transformer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/subsystem=elytron/security-domain=caseDomain:add(realms=[{realm=exampleRealm}], \
default-realm=exampleRealm,permission-mapper=default-permission-mapper, pre-realm-principal-transformer=myTransformer)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that creating an additional security domain (<code>caseDomain</code>in this case) is not necessary.
We could alternatively take the default <code>ApplicationDomain</code> and add the
FileSystem realm, role-decoder, principal transformer and permission-mapper to it.</p>
</div>
<div class="paragraph">
<p>We then add our security domain mapping to the EJB3 subsystem, update the <code>sasl-authentication-factory</code> to use
our security domain and update the <code>http-remoting-connector</code> to use our <code>sasl-authentication-factory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">/subsystem=ejb3/application-security-domain=other:add(security-domain=caseDomain)

/subsystem=elytron/sasl-authentication-factory=application-sasl-authentication:write-attribute(name=security-domain, value=caseDomain)

/subsystem=remoting/http-connector=http-remoting-connector:write-attribute(name=sasl-authentication-factory,value=application-sasl-authentication)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the above snippet, please refer to the quickstart this example is based on
<strong><a href="https://wildfly-security.github.io/wildfly-elytron/blog/advanced-ejb-security/">here</a></strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-client-wildfly-config-xml"><a class="anchor" href="#configuring-the-client-wildfly-config-xml"></a>Configuring the Client (wildfly-config.xml)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The username and credentials to establish the connection to the application server are configured in the
<code>wildfly-config.xml</code> file. Notice the username provided by the client is <code>quickstartuser</code> and the username we added to the
identity store is <code>QUICKSTARUSER</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;authentication-configurations&gt;
            &lt;configuration name="default-config"&gt;
                &lt;set-user-name name="quickstartuser"/&gt;
                &lt;credentials&gt;
                    &lt;clear-password password="quickstartPwd1!"/&gt;
                &lt;/credentials&gt;

                ...

            &lt;/configuration&gt;
&lt;/authentication-configurations&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we configured our <code>case-principal-transformer</code> to be used prior to accessing the security realm,
the principal provided by the client will  be adjusted to upper case resulting in successful authentication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-and-deploy-the-quickstart"><a class="anchor" href="#build-and-deploy-the-quickstart"></a>Build and Deploy the Quickstart</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you start the WildFly server.</p>
</li>
<li>
<p>Open a terminal and navigate to the root directory of this quickstart.</p>
</li>
<li>
<p>Type the following command to build the artifacts.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">    $ mvn clean install wildfly:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see a message in the server log indicating that the archive deployed successfully.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run-the-client"><a class="anchor" href="#run-the-client"></a>Run the Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you run the client, make sure you have successfully deployed the EJBs to the server in the previous step and that your
terminal is still in the root directory of this quickstart.</p>
</div>
<div class="paragraph">
<p>Run this command to execute the client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ mvn exec:exec</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="investigate-the-console-output"><a class="anchor" href="#investigate-the-console-output"></a>Investigate the Console Output</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you run the <code><code>mvn exec:exec</code></code> command, you should see the following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">* * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

Successfully called secured bean, caller principal QUICKSTARTUSER

Principal has admin permission: true

* * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</code></pre>
</div>
</div>
<div class="paragraph">
<p>The username and credentials to establish the connection to the application server are configured in the
<code>wildfly-config.xml</code>. Notice the username provided in the <code>wildfly-config.xml</code> file is <code>quickstartuser</code>
and the username stored in the identity store is <code>QUICKSTARTUSER</code>.</p>
</div>
<div class="paragraph">
<p>As expected, the <code>quickstartuser</code> was adjusted to <code>QUICKSTARTUSER</code> by the <code>case-principal-transformer</code> prior to accessing
the security realm and the principal was able to invoke the  method available for the <code>admin</code> role.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post has given an overview on how to use a <code>case-principal-transformer</code> in the
Elytron subsystem.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
</div>

            </div>
        </div>
    </main>
</div>
</body>
</html>
