<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Elytron: Automatic Self-Signed Certificate Generation with Elytron</title>
    <script src="/wildfly-elytron/assets/javascript/highlight.pack.js" type="text/javascript"></script>

    <link rel="shortcut icon" type="image/png" href="/wildfly-elytron/favicon.ico">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- We override the colours from this theme manually -->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="/wildfly-elytron/assets/css/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script src="/wildfly-elytron/assets/javascript/hl.js" type="text/javascript"></script>
    <link rel="alternate" type="application/rss+xml"  href="/wildfly-elytron/feed.xml" title="WildFly Elytron">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135301155-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-135301155-1');
    </script>
</head>
<body>


<!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header mdl-layout__header--scroll">
        <div class="mdl-layout__header-row ">
            <!-- Title -->
            <span class="mdl-layout-title"><h3>Wild<strong>Fly</strong>  Elytron</h3></span>
            <!-- Add spacer, to align navigation to the right -->
            <div class="mdl-layout-spacer"></div>
            <nav class="mdl-navigation mdl-layout--large-screen-only">
                
                    
                    
                         <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
                    
                
                    
                    
                         <a class="mdl-navigation__link Docs-menuitem" href="https://docs.wildfly.org/21/WildFly_Elytron_Security.html">Docs</a>
                    
                
                    
                    
                         <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
                    
                
                    
                    
                         <a class="mdl-navigation__link Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
                    
                
                    
                    
                         <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
                    
                
            </nav>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <div class="side-drawer-logo-container"><h3>Wild<strong>Fly</strong>  Elytron</h3></div>
        <nav class="mdl-navigation">
            
            
            
                <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
            
            
            
            
                <a class="mdl-navigation__link Docs-menuitem" href="https://docs.wildfly.org/21/WildFly_Elytron_Security.html">Docs</a>
            
            
            
            
                <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
            
            
            
            
                <a class="mdl-navigation__link Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
            
            
            
            
                <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
            
            
            <!-- mdl-navigation__link--current -->
        </nav>
    </div>
    <main class="mdl-layout__content">
        <div class="page-content">
            
            <div class="content">
                <div class="post-page grid-wrapper">
  <div class="grid__item width-12-12 width-12-12-m doc-content">
    <h1>Automatic Self-Signed Certificate Generation with Elytron</h1>
    <div class="grid-wrapper">
      <div class="grid__item width-8-12 width-12-12-m byline-wrapper">
        
        
          <img class="headshot" src="https://www.gravatar.com/avatar/e07a676199f6ad0af96a61a691b114b3">
        
        <p class="byline">By <a href="https://github.com/fjuma">Farah Juma</a> | January 05, 2021</p>
      </div>
      
      <div class="grid__item width-4-12 width-12-12-m"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://wildfly-security.github.io/wildfly-elytron/2021-01-05-auto-self-signed-certificate-generation.html&title=Automatic Self-Signed Certificate Generation with Elytron" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fab fa-linkedin"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Automatic Self-Signed Certificate Generation with Elytron&url=https://wildfly-security.github.io/wildfly-elytron/2021-01-05-auto-self-signed-certificate-generation.html&via=WildFlyAS&related=WildFlyAS" rel="nofollow" target="_blank" title="Share on Twitter">
    <i class="fab fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://wildfly-security.github.io/wildfly-elytron/2021-01-05-auto-self-signed-certificate-generation.html" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fab fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://wildfly-security.github.io/wildfly-elytron/2021-01-05-auto-self-signed-certificate-generation.html" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fab fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Automatic Self-Signed Certificate Generation with Elytron&amp;body=Automatic Self-Signed Certificate Generation with Elytron https://wildfly-security.github.io/wildfly-elytron/2021-01-05-auto-self-signed-certificate-generation.html" title="Share via Email" >
    <i class="fas fa-envelope-square"></i>
  </a>
</div>
</div>
      <div class="grid__item width-12-12">
          <div class="paragraph">
<p>WildFly 22 adds the ability to automatically generate a self-signed certificate the first time
WildFly receives an HTTPS request when WildFly is being secured using Elytron. This is useful
for development or testing environments. This blog post gives an introduction to this new feature.</p>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#default-ssl-context">Default SSL context</a></li>
<li><a href="#making-use-of-the-default-ssl-context">Making use of the default SSL context</a>
<ul class="sectlevel2">
<li><a href="#log-messages">Log messages</a></li>
</ul>
</li>
<li><a href="#switching-to-a-signed-certificate">Switching to a signed certificate</a>
<ul class="sectlevel2">
<li><a href="#pre-requisite-configuration">Pre-requisite configuration</a></li>
<li><a href="#switching-to-a-certificate-from-lets-encrypt">Switching to a certificate from Let&#8217;s Encrypt</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="default-ssl-context"><a class="anchor" href="#default-ssl-context"></a>Default SSL context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WildFly now contains configuration for one-way SSL out of the box. This means that by default,
the Elytron subsystem now contains a <code>key-store</code>, <code>key-manager</code>, and <code>server-ssl-context</code> that
are ready for you to use in a development or testing environment, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;subsystem xmlns="urn:wildfly:elytron:12.0" final-providers="combined-providers" disallowed-providers="O
racleUcrypto"&gt;
...
    &lt;tls&gt;
        &lt;key-stores&gt;
            &lt;key-store name="applicationKS"&gt;
                &lt;credential-reference clear-text="password"/&gt;
                &lt;implementation type="JKS"/&gt;
                &lt;file path="application.keystore" relative-to="jboss.server.config.dir"/&gt;
            &lt;/key-store&gt;
        &lt;/key-stores&gt;
        &lt;key-managers&gt;
            &lt;key-manager name="applicationKM" key-store="applicationKS" generate-self-signed-certificate-host="localhost"&gt;
                &lt;credential-reference clear-text="password"/&gt;
            &lt;/key-manager&gt;
        &lt;/key-managers&gt;
        &lt;server-ssl-contexts&gt;
            &lt;server-ssl-context name="applicationSSC" key-manager="applicationKM"/&gt;
        &lt;/server-ssl-contexts&gt;
    &lt;/tls&gt;
...
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the default <code>key-manager</code>, <code>applicationKM</code>, contains a <code>generate-self-signed-certificate-host</code>
attribute with value <code>localhost</code>. This attribute indicates that when this <code>key-manager</code> is used to obtain the
server&#8217;s certificate, if the file that backs its <code>key-store</code> doesn&#8217;t already exist, then the <code>key-manager</code> should
automatically generate a self-signed certificate with <code>localhost</code> as the Common Name. This generated self-signed
certificate will then be stored in the file that backs the <code>key-store</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="making-use-of-the-default-ssl-context"><a class="anchor" href="#making-use-of-the-default-ssl-context"></a>Making use of the default SSL context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To make use of the new default SSL context, the Undertow subsystem <code>https-listener</code> configuration
just needs to be updated to reference the Elytron <code>server-ssl-context</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">batch
/subsystem=undertow/server=default-server/https-listener=https:undefine-attribute(name=security-realm)
/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=ssl-context,value=applicationSSC)
run-batch
reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this change, WildFly will automatically generate a self-signed certificate the first time it receives
an HTTPS request if the server&#8217;s key store file (<code>application.keystore</code>) does not already exist.</p>
</div>
<div class="paragraph">
<p>To try this out, try accessing <a href="https://localhost:8443" class="bare">https://localhost:8443</a>. Notice that WildFly generates and presents a
self-signed certificate and your browser presents a warning message. Inspect the certificate and verify
that the fingerprints shown in your browser match the fingerprints shown in the server log file before
confirming that you want to accept the server&#8217;s certificate.</p>
</div>
<div class="sect2">
<h3 id="log-messages"><a class="anchor" href="#log-messages"></a>Log messages</h3>
<div class="paragraph">
<p>When using the default <code>server-ssl-context</code>, you&#8217;ll notice some warning messages in the server log file before
and after the self-signed certificate is automatically generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">13:21:39,197 WARN  [org.wildfly.extension.elytron] (MSC service thread 1-6) WFLYELY01083: KeyStore /wildfly/standalone/configuration/application.keystore not found, it will be auto generated on first use with a self-signed certificate for host localhost
...
13:39:57,152 WARN  [org.wildfly.extension.elytron] (default task-1) WFLYELY01084: Generated self-signed certificate at /wildfly/dist/target/wildfly-22.0.0.Final/standalone/configuration/application.keystore. Please note that self-signed certificates are not secure and should only be used for testing purposes. Do not use this self-signed certificate in production.
SHA-1 fingerprint of the generated key is fc:16:cf:bf:de:3a:6d:d6:fe:ec:f9:cd:9d:22:c9:3d:43:d7:e3:57
SHA-256 fingerprint of the generated key is 38:69:00:4e:39:e2:40:e2:ef:b6:95:58:c6:ba:d0:0f:56:c5:7c:5d:fc:d5:c3:b9:b0:94:80:9c:f5:45:9d:40</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned in the warning message, it is very important that the generated self-signed certificate is only used
a development or testing environment. Self-signed certificates should never be used in a production environment.
To disable the automatic self-signed certificate generation, simply undefine the <code>generate-self-signed-certificate-host</code>
attribute for the default <code>key-manager</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="switching-to-a-signed-certificate"><a class="anchor" href="#switching-to-a-signed-certificate"></a>Switching to a signed certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since the default WildFly configuration contains one-way SSL configuration out of the box, it is now
very simple to switch to using a signed certificate.</p>
</div>
<div class="sect2">
<h3 id="pre-requisite-configuration"><a class="anchor" href="#pre-requisite-configuration"></a>Pre-requisite configuration</h3>
<div class="paragraph">
<p>We&#8217;re going to switch to using a certificate from Let&#8217;s Encrypt so we first need to configure
a Let&#8217;s Encrypt account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">/subsystem=elytron/key-store=accountsKS:add(path=accounts.keystore.jks,relative-to=jboss.server.config.dir,credential-reference={clear-text=secret},type=JKS)
/subsystem=elytron/certificate-authority-account=myLetsEncryptAccount:add(alias=letsEncrypt,key-store=accountsKS,contact-urls=[mailto:admin@admin.org])</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="switching-to-a-certificate-from-lets-encrypt"><a class="anchor" href="#switching-to-a-certificate-from-lets-encrypt"></a>Switching to a certificate from Let&#8217;s Encrypt</h3>
<div class="paragraph">
<p>First, undefine the <code>generate-self-signed-certificate-host</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">/subsystem=elytron/key-manager=applicationKM:undefine-attribute(name=generate-self-signed-certificate-host)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, use the <code>applicationKS</code> key store to obtain a signed certificate from Let&#8217;s Encrypt (make sure you update
the <code>domain-names</code> parameter to specify the domain name(s) you want to obtain a certificate for):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">/subsystem=elytron/key-store=serverKS:obtain-certificate(alias=server,domain-names=[www.example.org],certificate-authority-account=myLetsEncryptAccount,agree-to-terms-of-service)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, reload your <code>key-manager</code> so that WildFly makes use of your newly obtained signed certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">/subsystem=elytron/key-manager=applicationKM:init()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post has given an overview of automatic self-signed certificate generation for WildFly.
This feature should only be used in development or testing environments. For more details on this,
take a look at the <a href="https://docs.wildfly.org/22/WildFly_Elytron_Security.html#Elytron_Subsystem">documentation</a>.
For more information on how to switch to a certificate from Let&#8217;s Encrypt, take a look at this
<a href="https://wildfly-security.github.io/wildfly-elytron/blog/obtaining-certificates-from-lets-encrypt-using-the-wildfly-cli/">blog post</a>.
Details on how to switch to a certificate signed by a different certificate authority that implements the
Automated Certificate Management Environment (ACME) protocol can be found
<a href="https://dvilkola.wordpress.com/2019/06/11/obtain-and-manage-certificates-from-any-server-instance-that-implements-acme-specification-using-the-wildfly-cli/">here</a>.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
</div>

            </div>
        </div>
    </main>
</div>
</body>
</html>
